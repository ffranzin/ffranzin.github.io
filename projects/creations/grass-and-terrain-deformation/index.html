<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Flavio Franzin | Grass Deformation and Terrain Trails</title>
  <meta property="og:title" content="Flavio Franzin | Grass Deformation and Terrain Trails" />
  <meta property="og:image" content="/perfil.jpg" />
  <meta name="description" content="I developed a solution for the real-time long-lasting grasses deformation and terrain trails according to the vehicles&#39; and characters&#39; movements.">
  <meta property="og:description" content="I developed a solution for the real-time long-lasting grasses deformation and terrain trails according to the vehicles&#39; and characters&#39; movements." />
  <meta name="author" content="Flavio Franzin ">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
  
  <link rel="preload" href="https://fonts.googleapis.com/css?family=Saira+Extra+Condensed:100,200,300,400,500,600,700,800,900&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Saira+Extra+Condensed:100,200,300,400,500,600,700,800,900&display=swap"></noscript>
  <link rel="preload" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
      <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i&display=swap"></noscript>
  <link rel="preload" href="https://use.fontawesome.com/releases/v5.12.1/css/all.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.1/css/all.css"></noscript>
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/devicons/1.8.0/css/devicons.min.css" integrity="sha512-JW3fT0YTK7pT7w437SoX6GcW76jOZ6E0jGmrqBAcloC4GKT+njHOY4fX5KxJ9WfIXTkNrAF994525fAHp+KCxg==" crossorigin="anonymous" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/devicons/1.8.0/css/devicons.min.css" integrity="sha512-JW3fT0YTK7pT7w437SoX6GcW76jOZ6E0jGmrqBAcloC4GKT+njHOY4fX5KxJ9WfIXTkNrAF994525fAHp+KCxg==" crossorigin="anonymous"></noscript>
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/simple-line-icons/2.5.5/css/simple-line-icons.min.css" integrity="sha512-QKC1UZ/ZHNgFzVKSAhV5v5j73eeL9EEN289eKAEFaAjgAiobVAnVv/AGuPbXsKl1dNoel3kNr6PYnSiTzVVBCw==" crossorigin="anonymous" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/simple-line-icons/2.5.5/css/simple-line-icons.min.css" integrity="sha512-QKC1UZ/ZHNgFzVKSAhV5v5j73eeL9EEN289eKAEFaAjgAiobVAnVv/AGuPbXsKl1dNoel3kNr6PYnSiTzVVBCw==" crossorigin="anonymous"></noscript>
  
  <link rel="preload" href="/css/resume.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/css/resume.css"></noscript>
  <link rel="preload" href="/css/tweaks.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/css/tweaks.css"></noscript>
  <link rel="preload" href="/css/resume-override.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/css/resume-override.css"></noscript>
  <meta name="generator" content="Hugo 0.88.1" />
  
   
  
</head>
<body id="page-top">
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top" id="sideNav">
  <a class="navbar-brand js-scroll-trigger" href="#page-top">
    <span class="d-block d-lg-none">Flavio Franzin </span>
    <span class="d-none d-lg-block">
      <img class="img-fluid img-profile rounded-circle mx-auto mb-2" src="/perfil.jpg" alt="">
    </span>
  </a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav">
          <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="/#about">About</a>
          </li>
          

          
          <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="/#experience">Experience</a>
          </li>
          
          
          <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="/#projects">Projects</a>
          </li>
          


          


          
          
          
          <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="/#Publications">Publications</a>
          </li>
          
      </ul>
  </div>
</nav>

  <div class="container-fluid p-0">
    
<nav aria-label="breadcrumb">
  <ol  class="breadcrumb">
    







<li class="breadcrumb-item">
  <a href="/">Home</a>
</li>


<li class="breadcrumb-item">
  <a href="/projects/">Projects</a>
</li>


<li class="breadcrumb-item">
  <a href="/projects/creations/">Projects and Main Achievements</a>
</li>


<li class="breadcrumb-item active">
  <a href="/projects/creations/grass-and-terrain-deformation/">Grass Deformation and Terrain Trails</a>
</li>

  </ol>
</nav>




<section class="resume-section p-3 p-lg-5 d-flex d-column">
    <div class="my-auto">
        <h2 class="mb-0"><span class="text-primary">Grass Deformation and Terrain Trails</span></h2>
        <style>
* {
  box-sizing: border-box;
}

.img-container {
  float: left;
  width: 25%;
  padding: 2px;
}

.video-container {
  float: left;
  width: 50%;
  padding: 2px;
}

.clearfix::after {
  content: "";
  clear: both;
  display: table;
}


.center {
  display: block;
  margin-left: auto;
  margin-right: auto;
  max-width: 50%;
}


</style>
<p>I developed a solution for the real-time long-lasting grasses deformation and terrain trails according to the vehicles' and characters' movements.</p>
<p><br />
<strong>Motivation</strong></p>
<p>In the context of military simulations, the deformation of terrains and grasses according to the movement of military vehicles is dangerous, as it can reveal the position to the enemies. Thus, a feature to simulate this is widely imperative. This functionality was desired but always denied by the development team due to several computational challenges. The main one was the incalculable storage cost to deform grams and keep them bent for many hours or even days of simulation in large-scale scenarios. Based on that, I prototyped an alternative solution that deals with low storage demand. It was presented to the customer, who aroused much interest. Thus, we improved and integrated the solution into the application.</p>
<p><br />
<br />
<strong>Solution</strong></p>
<p>The approach involves dividing the scenarios into smaller sections using a quadtree and implementing a vector field to determine the direction of plants for each node. The vector fields are updated accordingly to objects move through the scenario. For performance purposes, complex 3D objects are approximated by planes and spheres (image below). When the colliders interact with the grass, vector fields are updated and the cost is assigned to restore each vector, allowing the simulation of different behaviors. For example, if a human disrupts the grass, it can quickly regain its shape, whereas if a vehicle damages the vector field, it may take longer to restore it (you can see both of these behaviors in the accompanying video).</p>
<img src="\grass_and_terrain _deformation\ColliderExample.jpg" alt="Nature" class="center">
<p><br />
In the vertex shader, grasses and small shrubs sample the vector fields to identify their orientation based on the interpolation of the closest vectors. Below we have a color debug showing the direction of the vectors in the vector fields after moving a vehicle. Also, we have the result after rendering, showing the vehicle&rsquo;s path.</p>
 <div class="clearfix">
  <div class="img-container">
  <img src="\grass_and_terrain _deformation\TankPrint4.jpg" alt="Italy" style="width:100%">
  </div>
  <div class="img-container">
  <img src="\grass_and_terrain _deformation\TankPrint5.jpg" alt="Italy" style="width:100%">
  </div>
  <div class="img-container">
  <img src="\grass_and_terrain _deformation\TankPrint2.jpg" alt="Italy" style="width:100%">
  </div>
   <div class="img-container">
  <img src="\grass_and_terrain _deformation\TankPrint3.jpg" alt="Italy" style="width:100%">
  </div>
</div>
<p><br />
In the fragment shader stage to texture the terrain the vector fields are sampled for a slight color attenuation. Here, the sample in the vector field is used to make a cross product with the up_vector, resulting in a scalar value used to attenuate the terrain fragment&rsquo;s color. It is interesting to highlight deformation in far regions without 3D grams. The two images on the left show the before and after vehicles' movement, highlighting the path by terrain&rsquo;s texturing. The two images on the right show the influence of the trails projected on terrain to improve the blend of deformed grams and the terrain.</p>
  <div class="clearfix">
  <div class="img-container">
  <img src="\grass_and_terrain _deformation\trails_2.jpg" alt="Italy" style="width:100%">
  </div>
  <div class="img-container">
  <img src="\grass_and_terrain _deformation\trails_1.jpg" alt="Italy" style="width:100%">
  </div>
  <div class="img-container">
  <img src="\grass_and_terrain _deformation\trails_3.jpg" alt="Italy" style="width:100%">
  </div>
  <div class="img-container">
  <img src="\grass_and_terrain _deformation\trails_4.jpg" alt="Italy" style="width:100%">
  </div>
</div>
<p><br />
Compute-shaders were used to deform and restore the vector fields. LOD and GPU-instancing techniques were used to optimize plants' rendering. Vector fields are kept in a TextureAtlas to reuse memory, preventing allocations and memory fragmentation. Vector fields far way from the camera without dynamic objects close are compressed (using the LZ4 algorithm) to save memory. When needed, the vector fields are decompressed. Then, it is possible to maintain deformations for long periods with a low storage cost. Due to the minimal variation in vector field data, compression rates can be extremely high, resulting in memory savings of 90-95%.</p>
<p><br />
<br />
<strong>Results</strong></p>
<p>Below, on the left, is shown a demonstration with several colliders interacting with the plants simultaneously. On the right, is an example of a vehicle interacting with plants. Note that plants that interact with the base reestablish their original form more quickly than plants that interact with the tank&rsquo;s tracks.</p>
 <div class="clearfix">
  <video controls class="video-container">
    <source src="\grass_and_terrain _deformation\grass-deformation-1.mp4" type="video/mp4" class="video">
    </video>
    <video controls class="video-container">
        <source src="\grass_and_terrain _deformation\grass-deformation-2.mp4" type="video/mp4" class="video">
    </video>
    </div>
<br/>
<p><br />
<br />
More details can be seen <a href="https://www.sbgames.org/sbgames2019/files/papers/ComputacaoFull/198047.pdf">here</a>.</p>

        

        <br />
        <br />
        <br />
        
<style>
    text_capitalize {
        text-transform: capitalize;
    }
</style>


<ul class="tags">
    
    <li><text_capitalize><a class="tag" href="/tags/memory-management">Memory Management</a></text_capitalize></li>
    
    <li><text_capitalize><a class="tag" href="/tags/compute-shaders">Compute shaders</a></text_capitalize></li>
    
    <li><text_capitalize><a class="tag" href="/tags/computer-graphics">Computer graphics</a></text_capitalize></li>
    
    <li><text_capitalize><a class="tag" href="/tags/shader">Shader</a></text_capitalize></li>
    
    <li><text_capitalize><a class="tag" href="/tags/data-compression">Data compression</a></text_capitalize></li>
    
    <li><text_capitalize><a class="tag" href="/tags/real-time">Real-time</a></text_capitalize></li>
    
    <li><text_capitalize><a class="tag" href="/tags/gpu-based">GPU-Based</a></text_capitalize></li>
    
    <li><text_capitalize><a class="tag" href="/tags/collision-simulation">Collision Simulation</a></text_capitalize></li>
    
    <li><text_capitalize><a class="tag" href="/tags/large-scale-scenario">Large-Scale scenario</a></text_capitalize></li>
    
</ul>

    </div>



</section>


    <span style="color: #999999; font-size: 60%;">Nifty <a href="https://codepen.io/wbeeftink/pen/dIaDH">tech tag lists</a> from <a class="pen-owner-link" href="https://codepen.io/wbeeftink">Wouter Beeftink</a> </span>
    
  </div>
  
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>

  
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js" integrity="sha512-0QbL0ph8Tc8g5bLhfVzSqxe9GERORsKhIn1IrpxDAgUsbBGz/V7iSav2zzW325XGd1OMLdL4UiqRJj702IeqnQ==" crossorigin="anonymous"></script>
  
  <script async src="/js/resume.js"></script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=XX-123446-01"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'XX-123446-01');
  </script>
  

  
</body>
</html>
